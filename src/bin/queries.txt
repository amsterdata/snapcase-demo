WITH alcohol_sales AS (
	SELECT    o.user_id, COUNT(*) as num_items
	  FROM    'datasets/instacart/products.parquet' p
	  JOIN    'datasets/instacart/order_products.parquet' op
	    ON    p.product_id = op.product_id
	  JOIN    'datasets/instacart/orders.parquet' o
	    ON    o.order_id = op.order_id
	 WHERE    p.aisle_id IN (27, 28, 62, 124, 134)
	GROUP BY  o.user_id
)

SELECT user_id, num_items
FROM alcohol_sales
WHERE num_items > 10 AND num_items < 25
LIMIT 10;


	SELECT    op.order_id, op.product_id, p.product_name
	  FROM    'datasets/instacart/products.parquet' p
	  JOIN    'datasets/instacart/order_products.parquet' op
	    ON    p.product_id = op.product_id
	  JOIN    'datasets/instacart/orders.parquet' o
	    ON    o.order_id = op.order_id
	 WHERE    p.aisle_id IN (27, 28, 62, 124, 134)
	   AND    o.user_id = 40058
  ORDER BY   o.user_id, op.order_id;


WITH meat_sales AS (
	SELECT    o.user_id, COUNT(*) as num_items
	  FROM    'datasets/instacart/products.parquet' p
	  JOIN    'datasets/instacart/order_products.parquet' op
	    ON    p.product_id = op.product_id
	  JOIN    'datasets/instacart/orders.parquet' o
	    ON    o.order_id = op.order_id
	 WHERE    p.aisle_id IN (5, 15, 33, 34, 35, 49, 95, 96, 106, 122)
	GROUP BY  o.user_id
)

SELECT user_id, num_items
FROM meat_sales
WHERE num_items > 20 AND num_items < 35
LIMIT 20;


WITH meat_sales AS (
	SELECT    o.user_id, COUNT(*) as num_items
	  FROM    'datasets/instacart/products.parquet' p
	  JOIN    'datasets/instacart/order_products.parquet' op
	    ON    p.product_id = op.product_id
	  JOIN    'datasets/instacart/orders.parquet' o
	    ON    o.order_id = op.order_id
	 WHERE    p.aisle_id IN (96, 106)
	GROUP BY  o.user_id
)

SELECT user_id, num_items
FROM meat_sales
WHERE num_items > 10 AND num_items < 15
LIMIT 20;


WITH unhealthy_sales AS (
	SELECT    o.user_id, COUNT(*) as num_items
	  FROM    'datasets/instacart/products.parquet' p
	  JOIN    'datasets/instacart/order_products.parquet' op
	    ON    p.product_id = op.product_id
	  JOIN    'datasets/instacart/orders.parquet' o
	    ON    o.order_id = op.order_id
	 WHERE    p.aisle_id IN (37, 38, 45, 61, 77, 79, 106)
	GROUP BY  o.user_id
)

SELECT user_id, num_items
FROM unhealthy_sales
WHERE num_items > 10 AND num_items < 25
LIMIT 20;
